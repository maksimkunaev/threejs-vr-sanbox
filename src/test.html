<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Document</title>
</head>
<body>
    <div class="p-3" style="border: 1px solid gray; height: 300px; border-radius: 8px;">
  <span id="final" class="text-light"></span>
  <span id="interim" class="text-secondary"></span>


  <button id="start">start</button>
  <button id="stop">stop</button>
  <span id="status" class="">status</span>

</div>
  
  <script>
  class SpeechRecognizer {
    constructor(onResult) {
      this.onResult = onResult
      this.final_transcript = "";
    }

    init = () => {
     const SpeechRecognition =  window.SpeechRecognition || window.webkitSpeechRecognition;
     if (SpeechRecognition) {
        this.onSuccess()
      } else {
        console.log("Speech Recognition Not Available");
        alert("Speech Recognition Not Available");
      }
    }

    onSuccess = () => {
      let speechRecognition = new webkitSpeechRecognition();

      speechRecognition.continuous = true;
      speechRecognition.interimResults = true;
      speechRecognition.lang =  'en-US'

      speechRecognition.onstart = () => {};
      speechRecognition.onerror = () => {};
      speechRecognition.onend = () => {};

      speechRecognition.onresult = this._onResult
      this.speechRecognition = speechRecognition;
    }

    _onResult = (event) => {
      // Create the interim transcript string locally because we don't want it to persist like final transcript
      let interim_transcript = "";

      // Loop through the results from the speech recognition object.
      for (let i = event.resultIndex; i < event.results.length; ++i) {
        // If the result item is Final, add it to Final Transcript, Else add it to Interim transcript
        if (event.results[i].isFinal) {
          this.final_transcript += event.results[i][0].transcript;
        } else {
          interim_transcript += event.results[i][0].transcript;
        }
      }

      // Set the Final transcript and Interim transcript.
      // document.querySelector("#final").innerHTML = this.final_transcript;
      // document.querySelector("#interim").innerHTML = interim_transcript;

      this.onResult({
        final_transcript: this.final_transcript,
        interim_transcript,
       })
    }

    start = () => this.speechRecognition.start();;
    stop = () => this.speechRecognition.stop();;
  }

  const onResult = data => console.log(data);
  const speechRecognizer = new SpeechRecognizer(onResult);
  speechRecognizer.init();
  document.querySelector("#start").onclick = speechRecognizer.start
  document.querySelector("#stop").onclick = speechRecognizer.stop

    </script>
</body>
</html>